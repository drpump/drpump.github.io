---
layout: post_with_photo
title: Grappling with software development on an iPad Pro
photo: 
caption: 
photo-meta: Pana GX7, Pana 12-32mm, 2019 Stanwell Tops, NSW Australia
---

Software development on an iPad Pro is possible but not straightforward. Here's how I went about it. 

## Where I landed

This article describes the trials, tribulations and hair-pulling that occurred when I tried to do software
development on my 2018 iPad Pro. But for the impatient, let me summarise.

Even using cloud compute for test and run activities, development directly on the iPad proved near-impossible. 
There were two key issues:

1. There are some great text editors available for the iPad, but excluding iVim, none allow you to 
   do search/replace across multiple files. Refactoring (e.g. rename a function) is consequently 
   a nightmare. iVim is OK if you can deal with vi/vim modal editing and a mostly text-driven UI,
   but that was a step too far for me. 
2. The kicker is that all of the browsers on the iPad are based on Apple webkit and don't include any inspect
   or debug capabilities. If you're building a web application, it becomes impossible to test or debug. 

The solution was to use a Raspberry Pi 4 as a _companion_ device, as popularized by TechCraft on his series
of [YouTube videos](https://www.youtube.com/watch?v=IR6sDcKo3V8). 

### My portable setup

[image]

The iPad powers and connects to the pi via USB-C. I drive the Pi interface with Jump Desktop. Jump Desktop allows me
me to use the iPad screen as a trackpad and is generally pretty friendly for portable useage. My parts list:

1. Apple magic keyboard (mine is the older version)
2. Incase Origami keyboard cover/stand (Studio Neat has the [Canopy](https://www.studioneat.com/products/canopy)
   for newer keyboards)
3. Raspberry Pi 4 (4GB) with 128GB Samsung EVO SD card and Raspbian in an Argon Neo case
4. 15cm (6") USB-C (USB-2 spec) cable. Until recently, Pi 4 devices like mine had an error in the USB-C wiring, and
   can only be powered by USB-2 spec cables. USB-3 spec cables don't generally work.
5. The `headmelted` build of VS Code for ARM. 

I made two changes to `/boot/config.txt` on the Pi:

1. enable ethernet over USB
2. Set the screen resolution to match the iPad Pro aspect ratio and give reasonable default font sizing:

```
# enable ethernet over USB
dtoverlay=dwc2

# force a console size for use via VNC
framebuffer_width=1600
framebuffer_height=1200
```

### Adding power

To charge the iPad while connected, I added:
4. A USB-C hub with power delivery (mine is from 
   [blupeak](https://blupeak.com.au/collections/usb-c-docks/products/blupeak-usb-c-multi-port-adapter-hdmi4k-2xusb3-0-pd), 
   cost AUD$50 (~USD$35))
5. USB-A to USB-C (USB 2.0) cable to connect from the hub to the Pi
6. A logitech M238 wireless mouse (easier to drive the UI and worthwhile for the portable setup too)

[image]

A few notes are worthwhile:

* The Pi power + network only works via the Pi USB-C port, hence the USB-A to USB-C cable
* The network connectivity to the Pi works by making the Pi look like a USB ethernet adapter. Hubs
  with a built-in ethernet port effectively hide the Pi, so won't work. 
* You have to connect the pi **last** when you set this up. The powered hub and its "master" (the iPad) 
  negotiate power delivery to the USB-A ports when you connect to the master. This causes power 
  to fluctuate at these ports and the pi reboots without a clean shutdown (bad). 

### With an external monitor

If I have an external monitor (e.g. at the office), I can connect the Pi to the monitor:

[image]

As long as Jump Desktop has the current focus on the iPad, keystrokes on the iPad keyboard are passed through to 
Raspbian. Having Jump Desktop as a slideover app is sufficient, which means I can fairly easily switch between
coding on the Pi and local apps on the iPad. Alternatively, I could connect a keyboard directly to the Pi but 
this takes a bit more desk space and means more to carry when I'm heading to a remote office.

I also modified `/boot/config.txt` and commented out the forced console size so that it would auto-detect the monitor
resolution. I find that Raspbian sometimes boots twice (i.e. automatic reboot) to detect the resolution.

### Ongoing issues

This setup is convenient and works reasonably well but is far from perfect. Issues encountered include:

* I've found that a number of dev tools and applications don't run out-of-the-box on ARM devices. For example,
  a Ruby gem (therubyracer) builds a nodejs environment using the `depot` tools when installed. The `depot` 
  version used doesn't support ARM as a target architecture. Workaround was to use an alternative gem.
* There are quite a lot of docker images that don't have an ARM build. ElasticSearch, for example. Workaround
  is to install the app locally or build a custom image, assuming it will run on ARM.
* The Pi 4 is slow. For example, I use jekyll to build static web sites and it takes ~20 seconds to rebuild 
  a relatively simple site compared with ~2 seconds on my 2015 Macbook Pro. I/O speeds quite likely
  contribute, so connecting a fast SSD or NVME drive might help, but detracts from portability. 
  Note that the jekyll incremental build feature is currently quite buggy and didn't work on the Pi at all. 
* The combined weight of the bits is around 2kg which makes it heavier than quite a number of 
  lightweight Intel laptops. The iPad cover and keyboard + cover count for a big chunk of this weight,
  so replacing them with an Apple keyboard folio would bring us down to about 1.5kg (if you can live without
  a dedicated `Esc` key).
* Rasbian doesn't like having the power removed, so if you run out of juice or accidentally disconnect
  from the iPad before shutting down cleanly, you risk corruption of the SD card.
* I've had trouble finding an intuitive keymapping for VS Code on Linux for someone coming from a Mac. 
  The default X11 config on Armbian also grabs the `Option` and `Cmd` keystrokes for system menus.
  This is fixable but I haven't got there yet. 

These issues have workarounds but make it a less productive environment for coding than a traditional laptop. 

### Some solutions

I have plans to address most of the issues above by using cloud compute as suggested in a couple of my 
previous articles. The likely setup would be:

1. Use VS Code on the Pi in [remote mode](https://code.visualstudio.com/docs/remote/remote-overview) for 
   development on a cloud host or kubernetes cluster.
2. Buy a lighter and more compact iPad keyboard/case to address the weight issues. The new iPad Pro 
   [magic keyboard](https://www.apple.com/au/shop/product/MXQU2ZA/A/magic-keyboard-for-ipad-pro-129%E2%80%91inch-4th-generation-us-english) 
   looks like an awesome device and is a likely candidate, although at time of writing the weight is unknown 
   and it's bloody expensive!
3. Add a [PiJuice hat](https://uk.pi-supply.com/collections/pijuice) so that the Pi is not affected by
   disconnection of power. It means a bulkier case for the Pi however. The iPad Pro magic keyboard might make
   this less urgent since it has a USB-C port for powering the iPad (in effect a second USB-C port on the iPad).

Or I could just rub my lamp and ask the genie for a VS Code remote client and debug-capable browser running 
natively on the iPad. iOS 14 perhaps?
